# Documentation Drift Detective

A GitHub Action that analyzes pull requests to detect documentation that may need updates based on code changes, using AI-powered analysis and a documentation knowledge base.

## Features

- üïµÔ∏è **Smart Detection**: Uses AI to correlate code changes with documentation files
- üìä **Knowledge Base Integration**: Leverages classification data to identify high-risk documentation
- üéØ **Prioritized Analysis**: Focuses on documentation most likely to be affected
- üí¨ **Actionable Feedback**: Posts specific suggestions as PR comments
- ‚ö° **Configurable**: Adjustable sensitivity thresholds and analysis limits

## How It Works

1. **Load Knowledge Base**: Reads documentation classification data from `.github/docs-knowledge-base.json`
2. **Analyze PR Changes**: Examines the diff to understand what code was modified
3. **Identify Candidates**: Uses AI to determine which docs might be affected based on technical patterns and sensitivity levels
4. **Deep Analysis**: Analyzes the content of potentially affected documentation files
5. **Generate Feedback**: Posts structured comments with specific suggestions for updates

## Usage

### Basic Setup

```yaml
name: Documentation Drift Detection
on:
  pull_request:
    types: [opened, synchronize]

jobs:
  detect-docs-drift:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Detect Documentation Drift
        uses: ./actions/docs-drift-detective
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          copilot-token: ${{ secrets.COPILOT_TOKEN }}
```

### Advanced Configuration

```yaml
- name: Detect Documentation Drift
  uses: ./actions/docs-drift-detective
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    copilot-token: ${{ secrets.COPILOT_TOKEN }}
    knowledge-base-path: '.github/docs-knowledge-base.json'
    sensitivity-threshold: 2  # Only analyze docs with sensitivity >= 2
    comment-mode: 'review'    # Post as PR review instead of comment
    max-docs-to-analyze: 15   # Limit analysis to 15 docs max
```

## Inputs

| Input | Description | Required | Default |
|-------|-------------|----------|---------|
| `github-token` | GitHub token for API access | ‚úÖ | `${{ github.token }}` |
| `copilot-token` | GitHub Copilot API token | ‚ùå | `${{ github.token }}` |
| `knowledge-base-path` | Path to the documentation knowledge base file | ‚ùå | `.github/docs-knowledge-base.json` |
| `sensitivity-threshold` | Minimum code sensitivity level to trigger analysis (0-3) | ‚ùå | `2` |
| `comment-mode` | How to post comments (`comment`, `review`, `annotation`) | ‚ùå | `comment` |
| `max-docs-to-analyze` | Maximum number of docs to analyze per PR | ‚ùå | `20` |

## Outputs

| Output | Description |
|--------|-------------|
| `docs-analyzed` | Number of documentation files analyzed |
| `potential-updates-found` | Number of potential documentation updates identified |
| `high-priority-updates` | Number of high-priority updates found |

## Example Output

The action posts comments like this on pull requests:

```markdown
## üìö Documentation Drift Analysis

üîç **Analysis Summary:**
- 3 documentation files analyzed
- 5 potential updates identified
- 2 high-priority, 1 medium-priority, 0 low-priority

### üö® High Priority Updates

#### üìÑ `docs/api.md`

üö® **Authentication section, lines 45-60**
- References old AuthController methods that may have changed
- *Suggestion: Verify authentication flow and update examples*

‚ö†Ô∏è **Code examples, lines 120-135**
- Shows outdated API endpoint structure
- *Suggestion: Update endpoint examples to match current API*

#### üìÑ `docs/deployment.md`

üö® **Configuration section, lines 30-45**
- Environment variables may have changed
- *Suggestion: Review and update environment variable documentation*
```

## Configuration Tips

### Sensitivity Threshold
- **0**: Analyze all documentation (may be noisy)
- **1**: Include general technical documentation
- **2**: Focus on component-specific documentation (recommended)
- **3**: Only highly code-sensitive documentation

### Comment Modes
- **`comment`**: Posts as a regular PR comment (default)
- **`review`**: Posts as a PR review comment
- **`annotation`**: Posts as file annotations (future feature)

## Requirements

- Repository with a documentation knowledge base (generated by [Documentation Knowledge Base Updater](../docs-knowledge-base-updater))
- GitHub Copilot access for AI analysis
- Appropriate permissions for the GitHub token

## Integration Example

Complete workflow integrating both actions:

```yaml
name: Documentation Management
on:
  push:
    paths: ['**/*.md', '**/*.markdown']
  pull_request:
    types: [opened, synchronize]

jobs:
  update-knowledge-base:
    if: github.event_name == 'push'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: ./actions/docs-knowledge-base-updater
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          copilot-token: ${{ secrets.COPILOT_TOKEN }}
  
  detect-drift:
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: ./actions/docs-drift-detective
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          copilot-token: ${{ secrets.COPILOT_TOKEN }}
```

## Limitations

- Requires a pre-generated knowledge base from the Documentation Knowledge Base Updater
- AI analysis quality depends on the accuracy of the knowledge base classifications
- Large pull requests may hit API rate limits
- Currently supports only markdown-based documentation
